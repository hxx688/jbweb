<!-- 
 * Generated by Blade.
 * 2016-12-29 12:54:25
 -->
@layout("/common/_container.html"){

	<form data-url="${ctxPath}/${code}/audit" method="post" class="form-horizontal" role="form">
		<!-- 表单 -->
		@ var _table="dt_users";
		@ var _key="id";
		@ var _col=[
		@			  {name:"用户名", index:"user_name", type:"text", newline:true, length:8},
		@			  {name:"商家名称", index:"nick_name", type:"text", newline:true, length:8},
		@			  {name:"用户组别", index:"group_name", type:"text", newline:true, length:8},
		@			  {name:"联系地址", index:"address", type:"text", newline:true, length:8},
		@			  {name:"用户头像", index:"avatar", type:"image_view", newline:true, length:8},
		@			  {name:"电子邮箱", index:"email", type:"text", newline:true, length:8},
		@			  {name:"手机号码", index:"mobile", type:"text", newline:true, length:8},
		@			  {name:"企业规模", index:"qiyeguimo", type:"text", newline:true, length:8},
		@			  {name:"注册IP", index:"reg_ip", type:"text", newline:true, length:8},
		@			  {name:"问题答案商家简介", index:"safe_answer", type:"text", newline:true, length:8},
		@			  {name:"安全问题主营业务", index:"safe_question", type:"text", newline:true, length:8},
		@			  {name:"用户性别", index:"sex", type:"text", newline:true, length:8},
		@			  {name:"省", index:"province_name", type:"text", newline:true, length:8},
		@			  {name:"市", index:"city_name", type:"text", newline:true, length:8},
		@			  {name:"联系电话", index:"telphone", type:"text", newline:true, length:8},
		@			  {name:"身份证正面", index:"faren", type:"image_view", newline:true, length:8},
		@			  {name:"身份证反面", index:"chengnuoshu", type:"image_view", newline:true, length:8},
		@			  {name:"推荐人手持身份证图片", index:"tuijianren", type:"image_view", newline:true, length:8},
		@			  {name:"生日", index:"birthday", type:"text", newline:true, length:8},
		@			  {name:"注册时间", index:"reg_time", type:"text", newline:true, length:8}
		@		   ];
		@ include("/common/_curd/_edit.html", {"col":_col, "table":_table, "key":_key}){}
		@if(person.group_id == 2){
			<div class="form-group" style="display:block">
				<label class="col-sm-2 control-label no-padding-right">比例</label>			
				<div class="col-sm-8">
					<input type="text" id="bili" name="dt_users.bili" value="${person.bili!}" class="form-control" />
				</div>
			</div>
		@}
		<div class="form-group" style="display:block">
			<label class="col-sm-2 control-label no-padding-right">审核状态</label>			
			<div class="col-sm-8">
				<select id="status" name="dt_users.status" required >			
					<option value="">-请选择-</option>
					<option value="1">审核通过</option>
					<option value="2">退回</option>
				</select>
			</div>
		</div>
		<div class="form-group" style="display:block">
			<label class="col-sm-2 control-label no-padding-right">原因 </label>			
			<div class="col-sm-8">
				<input type="text" id="yuanyin" name="dt_users.yuanyin" value="${dt_users.yuanyin!}" class="form-control" />
			</div>
		</div>
		<!-- 按钮 -->
		<div class="clearfix form-actions center" style="margin-top:15px;margin-bottom:5px;">
			<div class="col-md-offset-1 col-md-10">
			  	<button class="btn btn-info" type="submit" id="btn_save">
					<i class="ace-icon fa fa-check bigger-110"></i>
					审核
				</button>

				&nbsp; &nbsp; &nbsp;
				<button class="btn" type="button" id="btn_close">
					<i class="ace-icon fa fa-close bigger-110"></i>
					关闭
				</button>
			</div>
		</div>
		<script src="${ctxPath}/static/validate/jquery-html5Validate.js"></script>
		<script type="text/javascript">
			var layerIndex = parent.layer.getFrameIndex(window.name); //获取窗口索引
			
			$(function(){
				$("form").html5Validate(function() {
					var $form = $(this);
					var status = $("#status").val();
					if(status == 2){
						var yuanyin = $("#yuanyin").val();
						if(yuanyin == ''){
							layer.alert("请填写退回原因")
							return;
						}
					}
					
					layer.confirm('确定要审核吗？', {
		                icon: 3,
		                btn: ['确定', '取消'] //按钮
		            }, function () {
		            	if( typeof saveBefore === 'function' ){
							saveBefore();
				        }
						$("#btn_save").attr("disabled","disabled");
						var appindex = appLoading();
						
						var ajax = new $ax($form.attr("data-url"), function(data){
							if (data.code === 0) {
								clearLoading(appindex);
								layer.msg(data.message, {shift: 1});
								setTimeout(function(){
									closeTab(true);
								},500);
								return false;
							} else {
								clearLoading(appindex);
								$("#btn_save").removeAttr("disabled","disabled");
								if(data.code===999){
									layer.alert(data.message, {icon: 2,title:"发生错误"});
								}
								else{
									layer.msg(data.message, {shift: 6,time:2000});
								}
								return false;
							}
						});
						ajax.data = $form.serialize();
						ajax.start();
						
						return false;
		            }, function () {
		                //layer.msg('已取消');
		            });
					
				}, {
					// novalidate: false
				});
				
				$("#btn_close").bind("click",function(){
					closeTab(("${auto_close!}" == "true") ? true : false);
				});
				
				function closeTab(isReload){
					//未找到layerIndex代表为新增tab页
					if(typeof (layerIndex) == "undefined"){
						var tabId = "";
						var dataUrl = $("form").attr("data-url");
						if(typeof (dataUrl) == "undefined"){
							tabId = "btn_${code}_view_${id!}";
						}else if(dataUrl.indexOf("save") > 0){
							tabId = "btn_${code}_add";
						}else if(dataUrl.indexOf("update") > 0){
							tabId = "btn_${code}_edit_${id!}";
						}else{
							tabId = "btn_${code}_view_${id!}";
						}
						if(isReload){
							window.top.reloadTabById("${code!}")
						}
						window.top.autoClose(tabId,"${code!}");
					} else{
						if(isReload){
							parent.searchGrid();
						}
						parent.layer.close(layerIndex);
					}
				}
				
			});
		</script>
	</form>

@}