<!-- 
 * Generated by Blade.
 * 2017-09-12 16:12:40
 -->
@layout("/common/_container.html"){

<script type="text/javascript">
	var grid_selector = "#grid-table";
	var pager_selector = "#grid-pager";
	var queryedSum = 0;
	
	$(function(){
		initGrid();
		initMenuBtn("btns", "${code}");
	});
	
	function initGrid(){
		var grid_url = "${ctxPath}/${code}/list";
		var _colnames = ["ID", 
						"手机号",
						"姓名",
						"总充值", 
						"总提现", 
						"总盈亏",
						"总手续费",
						"总收支",
						"上级代理商",
						"会员",
						"代理商",
						"状态",
						"是否代理",
						"级别"
						];
		var _colmodel = [
		                {name:"id", index:"id", width:50},
						{name:"mobile", index:"mobile", width:100},
						{name:"real_name", index:"real_name", width:100},
						{name:"recharge_total", index:"recharge_total", width:100,formatter:showMemberFin_recharge},
						{name:"withdraw_total", index:"withdraw_total", width:100,formatter:showMemberFin_withdraw},
						{name:"profi_loss_total", index:"profi_loss_total", width:100,formatter:showOrder},
						{name:"sxf_total", index:"sxf_total", width:100,formatter:showOrder},
						{name:"yingye_total", index:"yingye_total", width:100,formatter:showTotal},
						{name:"parent_name", index:"parent_name", width:100,formatter:agentShow},
						{name:"subct", index:"subct", width:80},
						{name:"agentct", index:"agentct", width:80},
						{name:"status", index:"status", width:100,formatter:rowShow},
						{name:"is_agent", index:"is_agent", width:100,formatter:rowShow_isAgent},
						{name:"level", index:"level", width:100}
						];
		jQuery(grid_selector).jqGrid({
			url : grid_url,
		    shrinkToFit : true,
			colNames : _colnames,
			colModel : _colmodel, 
			jsonReader : {id :"id",bean:"bean"},
			pager : pager_selector,
			postData : {sort : "id", order : "desc", member_id:"${member_id}"},
			rowNum : 10,
			rowList : [ 5,10, 20, 30 ],
			beforeRequest:function(){
				queryedSum = 0;
				$("#t4").html("--");
				ajaxSum(0);
				ajaxSum(1);
				ajaxSum(2);
				ajaxSum(3);
			}
			/*
			gridComplete:function(){
				var bean = jQuery(grid_selector).getGridParam('bean');
				var fix = bean.split(",");
				$("#t0").html(fix[0]);
				$("#t1").html(fix[1]);
				$("#t2").html(fix[2]);
				$("#t3").html(fix[3]);
				$("#t4").html((parseFloat(fix[2])-parseFloat(fix[3])).toFixed(2));
			}*/
		});
		
		function ajaxSum(type){
			$("#t"+type).html("--");
			var adjust = $("#LAY_layuipro").find("#adjust").val();
			var ajax = new $ax("${ctxPath}/yongjins/sum", function(data){
				if (data.code == 0) {
					$("#t"+data.message).html(data.data);
					queryedSum ++;
					if(queryedSum == 4){
						var v1 = parseFloat($("#t2").html());
						var v2 = parseFloat($("#t3").html());
						$("#t4").html((v1-v2).toFixed(2));
					}
					return false;
				} else {
					
					return false;
				}
			});
			
			ajax.data = {member_id:"${member_id}",
					"type":type,
					"user_id_skip":$('#_user_id_skip').val(),
					"create_time_gt_skip":$('#_create_time_gt_skip').val(),
					"create_time_lt_skip":$('#_create_time_lt_skip').val(),
					"mobile":$('#_mobile').val()
			};
			ajax.start();
		}
		
		function rowShow(cellvalue, options, rowObject) {
			var lx = rowObject.status;
			if(lx=='0'){
				return "<span style='color:green'>正常</span>"
			}else if(lx == '2'){
				return "<span style='color:blue'>待审核</span>"
			}else if(lx == '3'){
				return "<span style='color:red'>冻结</span>"
			}else if(lx == '4'){
				return "<span style='color:red'>审核拒绝</span>"
			}else{
				
			}
		}
		
		function rowShow_isAgent(cellvalue, options, rowObject) {
			var lx = rowObject.is_agent;
			if(lx=='1'){
				return "是";
			}else{
				return "否";
			}
		}
		
		function agentShow(cellvalue, options, rowObject){
			var lx = rowObject.level;			
			if(lx=='1'){
				return "<span style='color:green'>无</span>"
			}else{
				if(!cellvalue){
					return "";
				}else{
					return cellvalue;
				}
			}
		}
		
		
		function showMemberFin_recharge(cellvalue, options, rowObject) {
			return getUrl(cellvalue,rowObject,2,"充值");
		}
		
		function showMemberFin_withdraw(cellvalue, options, rowObject) {
			return getUrl(cellvalue,rowObject,3,"提现");
		}
		
		function showMemberFin_profi_loss(cellvalue, options, rowObject) {
			return getUrl(cellvalue,rowObject,4,"总盈亏");
		}
		
		function getUrl(cellvalue,rowObject,type,title){
			var id = rowObject.id;
			var title = rowObject.real_name+title;
			return "<a href='javascript:showMemberFin("+id+","+type+",\""+title+"\")'>"+cellvalue+"</a>";
		}
		
		// 显示平仓订单
		function showOrder(cellvalue, options, rowObject){
			var id = rowObject.id;
			var real_name = rowObject.real_name;
			return "<a href='javascript:showOrderFin("+id+",\""+real_name+"\")'>"+cellvalue+"</a>";
		}
		
		// 总收支
		function showTotal(cellvalue, options, rowObject){
			var n1 = parseFloat(rowObject.profi_loss_total);
			var n2 = parseFloat(rowObject.sxf_total);
			return n1-n2;
		}
		
	}
	
	function showMemberFin(id, type,title){
		var startDate = $("#_create_time_gt_skip").val();
		var endDate = $("#_create_time_lt_skip").val();
		if(startDate == "")startDate = "0";
		if(endDate == "")endDate = "0";
		
        var tabid = "showMemberFin_"+id+"_"+type;
        var url = "${ctxPath}/financial/showMemberFin/"+id+"/"+type+"/"+startDate+"/"+endDate;
        var obj = {close:true,icon:"",id:tabid,title:title,url:url};
        parent.addTabs(obj);
	}
	
	function showOrderFin(id, real_name){
		var startDate = $("#_create_time_gt_skip").val();
		var endDate = $("#_create_time_lt_skip").val();
		if(startDate == "")startDate = "0";
		if(endDate == "")endDate = "0";
		
        var tabid = "showOrder_"+id;
        var url = "${ctxPath}/order/indexpc2/"+id+"/"+startDate+"/"+endDate;
        var obj = {close:true,icon:"",id:tabid,title:"订单("+real_name+")",url:url};
        parent.addTabs(obj);
	}
	
</script>


	<!-- 配置 grid -->
	<div class="row">
		<div class="col-xs-12 tb-grid">
			<!-- 配置 查询 -->
			@ var _col=[
			@		{name:"姓名/ID", index:"user_id_skip", type:"text"},
			@		{name:"开始日期", index:"create_time_gt_skip", type:"date",format:"YYYY-mm-DD"},		
			@		{name:"结束日期", index:"create_time_lt_skip", type:"date",format:"YYYY-mm-DD"},
			@		{name:"手机号", index:"mobile", type:"text"}					
			@];
			@ include("/common/_function/_search_multi.html",{"col":_col}){}
			<!-- 按钮 -->
			<div class="welljq well-sm" id="btns"></div>
			<div class="welljq well-sm">
				<div style="font-size:15px;">
					充值：<span id="t0" style="color:red">0</span>
					&nbsp;提现：<span id="t1" style="color:red">0</span>
					&nbsp;盈亏：<span id="t2" style="color:red">0</span>
					&nbsp;手续费：<span id="t3" style="color:red">0</span>
					&nbsp;总收支：<span id="t4" style="color:red">0</span>
				</div>				
			</div>
			<!-- grid -->
			<table id="grid-table"></table>
			<!-- 分页-->
			<div id="grid-pager"></div>
		</div>
	</div>
	
	<!-- 引入所需的js -->
	@include("/common/_listscript.html", {isExport : false}) {}
	
@}	